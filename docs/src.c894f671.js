parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"bhQq":[function(require,module,exports) {
"use strict";function e(e){this.message=e,this.name="PeerNotFoundException"}Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.url=e,this.debug=t,this.peers=[],this.listeners={},this.addListener("connection_request",this.onConnectionRequest.bind(this)),this.addListener("connection_accepted",this.onConnectionAccepted.bind(this)),this.addListener("on_ice_candidate",this.onIceCandidate.bind(this)),this.addListener("add_ice_candidate",this.addIceCandidate.bind(this)),this.addListener("set_remote_description",this.setRemoteDescription.bind(this)),this.addListener("on_offer",this.onOffer.bind(this)),this.addListener("on_dc_open",this.onDCOpen.bind(this)),this.addListener("on_dc_message",this.onDCMessage.bind(this))}async getPeers(){return await fetch("https://7pd7gfpem8.execute-api.us-west-2.amazonaws.com/dev/peers").then(e=>e.json())}async requestConnection(e){await this.send("connection_request",e,{})}addListener(e,t){this.listeners[e]?this.listeners[e].push(t):this.listeners[e]=[t]}onEvent(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];this.listeners[e]&&this.listeners[e].forEach(e=>{e(...n)})}connect(){this.ws=new WebSocket(this.url),this.ws.addEventListener("open",e=>{this.onEvent("ws_open",e)}),this.ws.addEventListener("close",e=>{this.onEvent("ws_close",e)}),this.ws.addEventListener("error",e=>{this.onEvent("ws_error",e)}),this.ws.addEventListener("message",e=>{this.onEvent("ws_message",e)}),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data);try{this.onEvent(t.eventType,t)}catch(n){console.error("ws_message Error: ",n)}})}async send(e,t,n){await this.ws.send(JSON.stringify({eventType:e,to:t,data:n}))}async onConnectionRequest(e){try{const s=new n(e.from,this.onEvent.bind(this));this.addPeer(s),await s.connect(!1),await this.send("connection_accepted",e.from,{})}catch(t){console.error("ERROR: ",t)}}async onConnectionAccepted(e){const t=new n(e.from,this.onEvent.bind(this));this.addPeer(t);await t.connect(!0)}async setRemoteDescription(e){try{const n=this.getPeer(e.from),s=new RTCSessionDescription;if(s.type=e.data.offer.type,s.sdp=e.data.offer.sdp,await n.connection.setRemoteDescription(s),!n.connection.isHost){const e=await n.connection.createAnswer();await n.connection.setLocalDescription(e),this.send("set_remote_description",n.id,{offer:e})}}catch(t){console.error("ERROR: ",t)}}async addIceCandidate(e){try{const n=this.getPeer(e.from),s=new RTCIceCandidate(e.data.candidate);await n.connection.addIceCandidate(s)}catch(t){throw console.error("ERROR: ",t),t}}async onIceCandidate(e,t){if(t&&t.candidate){const n=t.candidate.toJSON();this.send("add_ice_candidate",e,{candidate:n})}}async onOffer(e,t){this.send("set_remote_description",e,{offer:t})}async onDCOpen(e,t){}async onDCMessage(e,t){}async rtcSend(e,t){try{this.getPeer(e).connection.send(t)}catch(n){throw console.error("ERROR: ",n),n}}getPeer(t){const n=this.peers.find(e=>e.id===t);if(void 0===n)throw new e("Peer not found with id: "+t);return n}addPeer(e){this.peers.push(e)}}exports.default=t;class n{constructor(e,t,n){this.id=e,this.onEvent=t,this.name=n,this.connection=null}async connect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.connection=new s(this.id,e,this.onEvent),await this.connection.init(),this.connection.pc.onicecandidate=(e=>{this.onEvent("on_ice_candidate",this.id,e)}),e){const e=await this.connection.createOffer();await this.connection.setLocalDescription(e),this.onEvent("on_offer",this.id,this.connection.pc.localDescription)}}}exports.Peer=n;class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;this.to=e,this.isHost=t,this.onEvent=n}async init(){this.pc=new RTCPeerConnection(null),this.pc.ondatachannel=this.ondatachannel.bind(this),this.isHost&&(this.dc=this.pc.createDataChannel(this.to),this.dc.onopen=this.onopen.bind(this),this.dc.onclose=this.onclose.bind(this),this.dc.onmessage=this.onmessage.bind(this))}ondatachannel(e){this.isHost||(this.dc=e.channel,this.dc.onopen=this.onopen.bind(this),this.dc.onclose=this.onclose.bind(this),this.dc.onmessage=this.onmessage.bind(this))}onopen(e){this.onEvent("on_dc_open",this.to,e)}onclose(e){console.log("onclose(): to",this.to)}onmessage(e){this.onEvent("on_dc_message",this.to,e)}send(e){this.dc.send(e)}async close(){await this.dc.close(),await this.pc.close(),this.dc=null,this.pc=null}async addIceCandidate(e){return console.log("addIceCandidate(): to",this.to),await this.pc.addIceCandidate(e)}async createOffer(){return console.log("createOffer(): to",this.to),await this.pc.createOffer()}async setLocalDescription(e){return console.log("setLocalDescription(): to",this.to),await this.pc.setLocalDescription(e)}async setRemoteDescription(e){return console.log("setRemoteDescription(): to",this.to),await this.pc.setRemoteDescription(e)}async createAnswer(){return console.log("createAnswer(): to",this.to),await this.pc.createAnswer()}}exports.Connection=s;
},{}],"9B6d":[function(require,module,exports) {
"use strict";var e=t(require("../../dist/client.js"));function t(e){return e&&e.__esModule?e:{default:e}}const n="wss://bamk6ty9r9.execute-api.us-west-2.amazonaws.com/dev",o=new e.default(n,!0);let c={x:0,y:0};const d=(e,t)=>{console.log("connecting to:  ",e),console.log("this: ",t),o.requestConnection(e)},l=async()=>{console.log("connecting to loby"),await o.connect()},s=e=>{let t=document.createElement("div");t.className="item";let n=document.createTextNode(e);t.appendChild(n);let o=document.createElement("input");o.type="button",o.value="connect",o.onclick=d.bind(void 0,e),t.appendChild(o),document.getElementById("peerList").append(t)};window.onload=(async()=>{let e=document.createElement("input");e.type="button",e.value="connect to lobby",e.onclick=l,document.body.appendChild(e),o.addListener("ws_open",async e=>{setInterval(async()=>{let e=await o.getPeers();const t=document.getElementById("peerList");for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{s(e.id)})},500)}),document.onmousemove=(e=>{c.x=e.x,c.y=e.y}),o.addListener("on_dc_open",(e,t)=>{console.log("on_dc_open",t),setInterval(()=>{o.rtcSend(e,JSON.stringify(c))})}),o.addListener("on_dc_message",(e,t)=>{let n=document.getElementById(e);n||((n=document.createElement("div")).className="square",n.id=e,document.body.appendChild(n));let o=JSON.parse(t.data);n.style.left=o.x+"px",n.style.top=o.y+"px"})});
},{"../../dist/client.js":"bhQq"}]},{},["9B6d"], null)
//# sourceMappingURL=/src.c894f671.js.map